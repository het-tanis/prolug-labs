### Lab Activities

Continue building out your test creation script by adding the cleanup required to remove the resources you created.

<br>
<details>
<summary>Solution</summary>

Set ansible to wait for 10 seconds and then delete the resources in the namespace.

vi unit7_kubernetes_test_creation.yaml

```plain
- hosts: localhost
  gather_facts: true
  vars:
  tasks:

  - name: Create a k8s namespace
    kubernetes.core.k8s:
      name: daily-test
      api_version: v1
      kind: Namespace
      state: present

  - name: create resource using name generated by the server
    kubernetes.core.k8s:
      state: present
      generate_name: nginx-
      definition:
        apiVersion: v1
        metadata:
          namespace: daily-test
        kind: Pod
        spec:
          containers:
          - name: nginx
            image: nginx
            imagePullPolicy: IfNotPresent

  - name: Pause for 10 seconds
    ansible.builtin.pause:
      seconds: 10

  - name: Get all pods in the specified namespace
    kubernetes.core.k8s_info:
      kind: Pod
      namespace: daily-test
    register: pod_list

  - name: Debug - Print pod names
    debug:
      msg: "Pods in daily-test: {{ pod_list | json_query('resources[*].metadata.name') }}"

  - name: Delete pods containing "nginx" in their name
    kubernetes.core.k8s:
      state: absent
      api_version: v1
      kind: Pod
      namespace: daily-test
      name: "{{ item }}"
    loop: "{{ pod_list | json_query('resources[*].metadata.name') }}"
    when: "'nginx' in item" 
```

Run the playbook and see if it properly deletes the resources

```plain
ansible-playbook unit7_kubernetes_test_creation.yaml
```{{exec}}

Add this last part and delete the namespace.

```plain
  - name: Create a k8s namespace
    kubernetes.core.k8s:
      name: daily-test
      api_version: v1
      kind: Namespace
      state: present
```

Execute and verify that the namespace no longer exists.

```plain
ansible-playbook unit7_kubernetes_test_creation.yaml
```{{exec}}

```plain
kubectl get ns
```{{exec}}

What other components might you use to make this more robust? What other checks might you do to test your environment?

</details>